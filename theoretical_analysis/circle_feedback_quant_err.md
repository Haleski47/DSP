# 环形量化噪声建模

本文以下图直接二型 IIR 为例，分析“环形（回环）量化误差”与“前向误差”的关系。

![ema](./pic/circle_noise.jpg)

## 回环增益的定义

分支$w_1$在反馈时，其系数：\[
    \alpha=1-\frac{1}{2^{a1}}
\] 
可以理解为$w_1$每次迭代衰减为$\alpha*w_1$,经过反复衰减与累加：
\[
    \sum_{k=0}^{n-1} \alpha^k\, w_1
    = w_1 \sum_{k=0}^{n-1} \alpha^k
    = w_1 \frac{1-\alpha^n}{1-\alpha}
    = \frac{w_1}{1-\alpha}
\]
因此，环形噪声增益$G=2^{a_1}$

另一个角度看，$X$到$W$的传递函数为：
\[
    W(z)=X(z) + (1 - \frac{1}{2^{a_1}}) \cdot W(z) z^{-1} \\
    H(z)= \frac{1}{1-(1-\frac{1}{2^{a_1}})z^{-1}}=G \\
    G_{z=1,低频}=2^{a_1} \\
    G_{z=1,高频}=2-\frac{1}{2^{a_1}}
\]

**环形增益定义为：**
\[
    G(z) = |\frac{1}{1+a_1z_1+a_2z_2}|
\]

## 环形量化误差的注入点

在图中$w_1>>a_1$，右移会引入最大1 lsb的量化误差，经过环形反馈后：
\[
Err_{max} = 1 * 2^{a_1} \\
Err_{mean} = \frac{2^{a_1}}{2} \\
Err_{sqrd} = \sqrt{\frac{1}{12}}Err_{mean}=0.29Err_{mean}
\]
下图为ema滤波器(直接二型)$w_0$的量化误差仿真结果：

![ema](./pic/noise_simu.jpg)

